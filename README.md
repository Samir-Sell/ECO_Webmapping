# Eco_Webmapping

This is a webmap I created for a school project. The webmap uses a fragment of wild life value sites which were downloaded from the [Governement of Ontario GeoHub](https://geohub.lio.gov.on.ca/datasets/wildlife-values-site/geoservice). The sites are all represented as point data with the majority of sites being important nesting areas. I will document my thought processes, the tools I used, and this issues I ran into below.

---

## Set up and Testing

I first had to learn the very basics of Javascript. I used a free [Udacity course](https://www.udacity.com/course/intro-to-javascript--ud803) to pick up the basics and learn syntax. I also had to learn the basics of HTML and CSS which I learned from vairous Youtube tutorials. Finally, in order to execute code server side, I had to learn the very basics of PHP which I also learned from Youtube tutorials and by studying the official PHP website. Finally, I learned the JS mapping framework called Leaflet which allows for the creation of light weight web maps. In addition, there was a lot of Googling specific problems that inevitably ocurred while I was actively creating the web map.

I decided on mapping the wild life value sites as I wanted the map to be relavant to my environmental science roots. To develop something that someone in the field can use to look for important nesting sites was a perfect fit. The first step was to download XAAMP and begin developing the basic HTML and CSS files within the htdocs folder of XAAMP. From there, I was able to run an apache server using XAAMP to view my website on localhost. I then had to install PHP on XAAMP in order to communicate between my server and the users machine. Originally, I ran into an issue where I could not access a specific PHP module which would allow me to send HTTP POST requests in order to communicate back and fourth from my server. To fix this, I discovered I had to go into my PHP configuration files within XAAMP and uncomment the PostgreSQL PDO module which then allowed for my PHP script to work. 

I was now able to implement my first button which allowed users to load nesting sites that were within their current view frame. I was able to do this by using a Leaflet method to return the coordinate bounds of the users current view field. I was then able to parse through the bounds to return the required information that would need to be entered into an SQL query to return the data. I used AJAX to action a POST call which sent my view frame extent to my server and call a script I created called load_data.php. Before I get into the specifics of the load_data.php script, PostgreSQL and PostGIS will need to be discussed. 

I installed PostgreSQL with the PostGIS extension. I had also loaded in a fragment of data from the wild life value sites data set. This data set was loaded into postgreSQL by using ogr2ogr which allowed me to load in shapefiles into the database. The load_data.php script used the PHP PDO data object in PHP to connect to my Postgres database and execute a query. The query would select geometries from my database that were within the bounding box paramters that were fed in from the user. Additionally, I chose to select the records as JSON. The returned selection was assigned to a variable and looped through in order to convert the JSON to a GeoJSON format that will be readable by Leaflet.JS. All records were then combined into a single GeoJSON file which was then returned to the user. Additionally, the GeoJSON text was written into a GeoJSON file locally on the server and stored there. If one already existed, the new file would replace the old one. This will lead us into the net functon. The user has the ability to download the currently displayed GeoJSON data that they have just generated. 

Another useful functionality was added to the web by using a Leaflet community add one called Leaflet.Draw. This add on allows the implementation of a control panel that allows the user to draw various shapes. In my case, I only wanted rectangles to be drawn so I disabled all other shapes besides rectangles. The rectangle acts as a bounding box tool that allows users to draw a rectangle in order to query for nest data from the database. I was able to access the latitude and longitude data from the created bounding box in order to parse the needed parameters for the SQL query that was located in my load_data.php script. Therefore, I was able to use a POST request to send the parameters to the server side script and return GeoJSON from the database to the user.  

